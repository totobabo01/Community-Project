<!-- /tpl/admin/roles.html -->
<div
    style="background: #fff; border-radius: 16px; box-shadow: 0 10px 30px rgba(31, 38, 135, 0.08); padding: 18px"
    ng-cloak
>
    <div style="background: #fbfdff; border: 1px solid #edf0f5; border-radius: 12px; padding: 18px">
        <div class="section-header">
            <div class="section-title">
                <span class="dot"></span>
                <h2 style="margin: 0">ê¶Œí•œ ê´€ë¦¬</h2>
            </div>

            <!-- ê´€ë¦¬ìë§Œ ìƒë‹¨ ë²„íŠ¼ ë…¸ì¶œ -->
            <div
                class="actions"
                ng-if="isAdmin"
            >
                <button
                    type="button"
                    class="btn btn-ghost"
                    ng-click="load()"
                    ng-disabled="loading"
                >
                    ìƒˆë¡œ ê³ ì¹¨
                </button>
            </div>
        </div>

        <!-- ì•ˆë‚´/ìƒíƒœ ë©”ì‹œì§€ -->
        <div
            class="status-box"
            ng-if="msg"
            ng-class="{'status-success': msgType==='success','status-error': msgType==='error','status-info': msgType==='info'}"
        >
            {{ msg }}
        </div>

        <!-- ë¹„ê´€ë¦¬ì ì „ìš© ì•ˆë‚´ -->
        <div
            class="status-box status-info"
            ng-if="!isAdmin"
        >
            ğŸ™ ì´ í˜ì´ì§€ëŠ” <strong>ê´€ë¦¬ì ì „ìš©</strong>ì…ë‹ˆë‹¤.
        </div>

        <!-- ê´€ë¦¬ì ì „ìš© ì˜ì—­ -->
        <div ng-if="isAdmin">
            <!-- â–¼â–¼ ê²€ìƒ‰ íˆ´ë°” (DB ì‚¬ìš©ì í™”ë©´ í†¤) â–¼â–¼ -->
            <style>
                .searchbar-row {
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    gap: 12px;
                    margin: 10px 0 14px;
                }
                .search-toolbar {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    background: #fff;
                    border: 1px solid #e9eef5;
                    border-radius: 10px;
                    padding: 8px 10px;
                    flex-wrap: wrap;
                }
                .search-toolbar .select,
                .search-toolbar .inline-input {
                    height: 36px;
                    border: 1px solid #e3e9f3;
                    border-radius: 8px;
                    padding: 0 10px;
                    font-size: 14px;
                    outline: none;
                    background: #fbfdff;
                }
                .search-toolbar .select:hover,
                .search-toolbar .inline-input:focus {
                    border-color: #cfe0ff;
                    box-shadow: 0 0 0 3px rgba(76, 132, 255, 0.15);
                    background: #fff;
                }
                .search-toolbar .btn {
                    height: 36px;
                    padding: 0 14px;
                    border-radius: 8px;
                    background: #4c84ff;
                    color: #fff;
                    border: none;
                    font-weight: 500;
                    cursor: pointer;
                    transition: 0.2s;
                }
                .search-toolbar .btn:hover {
                    background: #3c73ef;
                }
                .page-size-select {
                    height: 36px;
                    border: 1px solid #e3e9f3;
                    border-radius: 8px;
                    padding: 0 8px;
                    background: #fff;
                }
                .muted {
                    color: #7a889e;
                }
                .pill {
                    display: inline-block;
                    border-radius: 999px;
                    padding: 4px 10px;
                    font-size: 12px;
                    font-weight: 700;
                }
                .pill.green {
                    background: #e8f8ec;
                    color: #169b55;
                    border: 1px solid #c9efd7;
                }
                .pill.gray {
                    background: #eef3ff;
                    color: #4c84ff;
                    border: 1px solid #d8e2ff;
                }
                .btn-page {
                    border: 1px solid #e1e7f0;
                    background: #fff;
                    border-radius: 8px;
                    padding: 6px 10px;
                    margin-left: 4px;
                }
                .btn-page.active {
                    background: #4c84ff;
                    color: #fff;
                    border-color: #4c84ff;
                }
                .user-table {
                    width: 100%;
                    border-collapse: separate;
                    border-spacing: 0 8px;
                }
                .user-table thead th {
                    font-size: 13px;
                    color: #6a7a92;
                    text-align: left;
                    padding: 0 10px;
                }
                .user-table tbody tr {
                    background: #fff;
                    border: 1px solid #e9eef5;
                    border-radius: 10px;
                }
                .user-table tbody td {
                    padding: 12px 10px;
                }
            </style>

            <div class="searchbar-row">
                <div class="search-toolbar">
                    <!-- ì…€ë ‰íŠ¸ ë³€ê²½ ì¦‰ì‹œ ë°˜ì˜ -->
                    <!-- ê²€ìƒ‰ êµ¬ë¶„: ì‚¬ìš©ì / ê¶Œí•œ -->
                    <select
                        class="select"
                        ng-model="q.type"
                        ng-change="applySearch()"
                    >
                        <option value="username">ì‚¬ìš©ì</option>
                        <option value="role">ê¶Œí•œ</option>
                    </select>

                    <!-- í‚¤ì›Œë“œ -->
                    <input
                        class="inline-input"
                        style="width: 220px"
                        ng-model="q.keyword"
                        placeholder="ê²€ìƒ‰ì–´ ì…ë ¥"
                        ng-keypress="($event.which===13)&&applySearch()"
                    />

                    <button
                        type="button"
                        class="btn"
                        ng-click="applySearch()"
                    >
                        ê²€ìƒ‰
                    </button>
                    <button
                        type="button"
                        class="btn"
                        style="background: #eef3ff; color: #444"
                        ng-click="resetSearch()"
                    >
                        ì´ˆê¸°í™”
                    </button>
                </div>

                <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap">
                    <label class="muted">í˜ì´ì§€ í¬ê¸°</label>
                    <!-- ìˆ«ì ë°”ì¸ë”© ë³´ì¥ -->
                    <select
                        class="page-size-select"
                        ng-model="pageSize"
                        ng-options="s as s for s in pageSizes track by s"
                        ng-change="onSize()"
                    ></select>
                    <span
                        class="muted"
                        style="margin-left: 4px"
                    >
                        ì´ {{ (filtered && filtered.length) || 0 }}ê±´
                    </span>
                </div>
            </div>
            <!-- â–²â–² ê²€ìƒ‰ íˆ´ë°” â–²â–² -->

            <!-- í‘œ -->
            <table
                class="user-table"
                aria-label="ê¶Œí•œ ëª©ë¡"
            >
                <thead>
                    <tr>
                        <th style="width: 35%">ì‚¬ìš©ì</th>
                        <th style="width: 35%">ê¶Œí•œ</th>
                        <th style="width: 30%">ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- í˜ì´ì§•ëœ ê²°ê³¼ -->
                    <tr ng-repeat="row in paged track by row.username">
                        <td>{{ row.username }}</td>
                        <td>
                            <span
                                class="pill"
                                ng-class="{
                  'green':(row.role||'').toUpperCase()==='ROLE_ADMIN',
                  'gray':(row.role||'ROLE_USER').toUpperCase()!=='ROLE_ADMIN'
                }"
                            >
                                {{ (row.role || 'ROLE_USER') }}
                            </span>
                        </td>
                        <td>
                            <button
                                type="button"
                                class="btn btn-primary"
                                ng-disabled="saving || (row.role||'').toUpperCase()==='ROLE_ADMIN'"
                                ng-click="changeRole(row,'ROLE_ADMIN')"
                            >
                                ê´€ë¦¬ì ë¶€ì—¬
                            </button>
                            <button
                                type="button"
                                class="btn btn-ghost"
                                ng-disabled="saving || (row.role||'').toUpperCase()==='ROLE_USER'"
                                ng-click="changeRole(row,'ROLE_USER')"
                            >
                                ê´€ë¦¬ì í•´ì œ
                            </button>
                        </td>
                    </tr>

                    <tr ng-if="!paged.length && !loading">
                        <td
                            colspan="3"
                            style="text-align: center; color: #666"
                        >
                            í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div
                class="pager"
                style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center"
            >
                <div class="left">
                    <!-- pages ëŒ€ì‹  ì»¨íŠ¸ë¡¤ëŸ¬ ê³„ì‚°ì‹ ì‚¬ìš© -->
                    <span class="muted">í˜ì´ì§€ {{ (page||0)+1 }} / {{ pagesCount() }}</span>
                </div>
                <div class="right">
                    <button
                        type="button"
                        class="btn-page"
                        ng-click="first()"
                        ng-disabled="page<=0"
                    >
                        Â« ì²˜ìŒ
                    </button>
                    <button
                        type="button"
                        class="btn-page"
                        ng-click="prev()"
                        ng-disabled="page<=0"
                    >
                        â€¹ ì´ì „
                    </button>

                    <button
                        type="button"
                        class="btn-page"
                        ng-repeat="p in pageRange() track by $index"
                        ng-class="{active:p===page}"
                        ng-click="go(p)"
                    >
                        {{ p + 1 }}
                    </button>

                    <button
                        type="button"
                        class="btn-page"
                        ng-click="next()"
                        ng-disabled="page>=pagesCount()-1"
                    >
                        ë‹¤ìŒ â€º
                    </button>
                    <button
                        type="button"
                        class="btn-page"
                        ng-click="last()"
                        ng-disabled="page>=pagesCount()-1"
                    >
                        ë Â»
                    </button>
                </div>
            </div>
            <!-- /í˜ì´ì§€ë„¤ì´ì…˜ -->
        </div>
    </div>
</div>
