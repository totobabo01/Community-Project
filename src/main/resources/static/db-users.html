<!-- /db-users.html -->
<div style="background: #fff; border-radius: 16px; box-shadow: 0 10px 30px rgba(31, 38, 135, 0.08); padding: 18px">
    <div style="background: #fbfdff; border: 1px solid #edf0f5; border-radius: 12px; padding: 18px">
        <!-- â–¼â–¼ ê²€ìƒ‰íˆ´ë°” ì „ìš© ìŠ¤íƒ€ì¼(ìŠ¤ì½”í”„: .search-toolbar ì•ˆì—ì„œë§Œ ì ìš©) â–¼â–¼ -->
        <style>
            /* í–‰ ì „ì²´ ì»¨í…Œì´ë„ˆ: ì™¼ìª½(ê²€ìƒ‰) â”ƒ ì˜¤ë¥¸ìª½(í˜ì´ì§€ í¬ê¸°) */
            .searchbar-row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
                margin: 10px 0 14px;
            }
            /* ê³µí†µ íˆ´ë°” ë°•ìŠ¤ */
            .search-toolbar {
                display: grid;
                gap: 10px;
                background: #ffffff;
                border: 1px solid #e9eef5;
                border-radius: 10px;
                padding: 10px 12px;
                box-shadow: 0 6px 18px rgba(31, 38, 135, 0.06);
            }
            /* ì™¼ìª½ íˆ´ë°”ëŠ” 4ì—´: ì…€ë ‰íŠ¸, ì¸í’‹, ì´ˆê¸°í™”, ê²€ìƒ‰ */
            .search-toolbar.left {
                grid-template-columns: 140px 1fr auto auto;
                min-width: 420px;
            }
            /* ì˜¤ë¥¸ìª½ íˆ´ë°”ëŠ” 2ì—´: í˜ì´ì§€í¬ê¸°/ì´ê±´ìˆ˜ */
            .search-toolbar.right {
                grid-template-columns: auto auto;
                width: auto;
                min-width: 260px;
            }
            /* ê° í•„ë“œ */
            .search-toolbar .field {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .search-toolbar .field label {
                font-size: 12px;
                color: #6b7785;
                white-space: nowrap;
            }
            /* ì¸í’‹/ì…€ë ‰íŠ¸ í†¤ */
            .search-toolbar input[type='search'],
            .search-toolbar select {
                height: 34px;
                padding: 0 10px;
                border-radius: 8px;
                border: 1px solid #dde3ee;
                outline: none;
                background: #fbfdff;
            }
            .search-toolbar input[type='search']:focus,
            .search-toolbar select:focus {
                border-color: #98b7ff;
                box-shadow: 0 0 0 3px rgba(98, 139, 255, 0.15);
            }
            /* ì˜¤ë¥¸ìª½ ì •ë ¬ìš© */
            .search-toolbar .muted {
                color: #8b95a1;
                font-size: 13px;
            }
            /* í˜ì´ì§€ ë²„íŠ¼ë“¤ê³¼ ê°„ê²© ì‚´ì§ */
            .pager .btn-page {
                margin-left: 4px;
            }
            /* pill */
            .pill {
                display: inline-block;
                padding: 2px 8px;
                border-radius: 999px;
                font-size: 12px;
            }
            .pill.green {
                background: #e8fff1;
                color: #0b8f3a;
            }
            .pill.gray {
                background: #eff2f6;
                color: #5b6470;
            }
            /* í…Œì´ë¸” ê¸°ë³¸ */
            .user-table {
                width: 100%;
                border-collapse: collapse;
                background: #fff;
                border: 1px solid #edf0f5;
                border-radius: 10px;
                overflow: hidden;
            }
            .user-table th,
            .user-table td {
                padding: 10px 12px;
                border-bottom: 1px solid #f1f3f7;
                vertical-align: middle;
            }
            .user-table thead th {
                background: #f7f9fc;
                font-weight: 600;
                color: #3b4350;
            }
            .inline-input {
                width: 100%;
                height: 32px;
                border: 1px solid #dde3ee;
                border-radius: 8px;
                padding: 0 10px;
                background: #fbfdff;
            }
            .status-box {
                margin: 10px 0;
                padding: 10px 12px;
                border-radius: 8px;
                background: #f7f9fe;
                color: #345;
            }
            .status-success {
                background: #e9fff2;
                color: #116a36;
            }
            .status-error {
                background: #ffecec;
                color: #9c2b2b;
            }
            .status-info {
                background: #f3f7ff;
                color: #2f4b90;
            }
            .btn {
                padding: 6px 10px;
                border-radius: 8px;
                border: 1px solid #dbe2ee;
                background: #fff;
                cursor: pointer;
            }
            .btn-ghost {
                background: #fff;
            }
            .btn-primary {
                background: #3b82f6;
                border-color: #3b82f6;
                color: #fff;
            }
            .btn-danger {
                background: #ef4444;
                border-color: #ef4444;
                color: #fff;
            }
            .btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }
            .section-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin: 6px 0 14px;
            }
            .section-title {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .section-title .dot {
                width: 8px;
                height: 8px;
                background: #3b82f6;
                border-radius: 50%;
            }
            .pager {
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .btn-page {
                padding: 6px 10px;
                border: 1px solid #dbe2ee;
                background: #fff;
                border-radius: 8px;
            }
            .btn-page.active {
                background: #e9f0ff;
                border-color: #98b7ff;
            }
            .muted {
                color: #8b95a1;
            }
        </style>
        <!-- â–²â–² ê²€ìƒ‰íˆ´ë°” ì „ìš© ìŠ¤íƒ€ì¼ â–²â–² -->

        <div class="section-header">
            <div class="section-title">
                <span class="dot"></span>
                <h2 style="margin: 0">DB ì‚¬ìš©ì ê´€ë¦¬</h2>
            </div>

            <!-- ê´€ë¦¬ìë§Œ ìƒë‹¨ ë²„íŠ¼ ë…¸ì¶œ -->
            <div
                class="actions"
                ng-if="isAdmin"
            >
                <button
                    class="btn btn-ghost"
                    ng-click="loadUsers()"
                    ng-disabled="userStatusType==='info'"
                >
                    ìƒˆë¡œ ê³ ì¹¨
                </button>
                <button
                    class="btn btn-primary"
                    ng-click="goToNew()"
                >
                    ì—¬ëŸ¬ ëª… ì¶”ê°€
                </button>
            </div>
        </div>

        <!-- ì•ˆë‚´/ìƒíƒœ -->
        <div
            class="status-box"
            ng-if="userStatusMessage"
            ng-class="{
        'status-success': userStatusType==='success',
        'status-error'  : userStatusType==='error',
        'status-info'   : userStatusType==='info'
      }"
        >
            {{ userStatusMessage }}
        </div>

        <!-- ë¹„ê´€ë¦¬ì ì•ˆë‚´ -->
        <div
            class="status-box status-info"
            ng-if="!isAdmin"
        >
            ğŸ™ ì´ í˜ì´ì§€ëŠ” <strong>ê´€ë¦¬ì ì „ìš©</strong>ì…ë‹ˆë‹¤.
        </div>

        <!-- ê´€ë¦¬ì ì „ìš© ì˜ì—­ -->
        <!-- âœ… ng-if â†’ ng-show ë¡œ ë³€ê²½: ìƒˆ ìŠ¤ì½”í”„ ìƒì„± ë°©ì§€(í˜ì´ì§€ë„¤ì´ì…˜ ë³€ìˆ˜ ê·¸ë¦¼ì ë¬¸ì œ í•´ê²°) -->
        <div ng-show="isAdmin">
            <!-- âœ… ê²€ìƒ‰ íˆ´ë°” (ê²Œì‹œíŒê³¼ ë™ì¼ í†¤) -->
            <div class="searchbar-row">
                <!-- ì™¼ìª½: ê²€ìƒ‰ êµ¬ë¶„/ì…ë ¥/ë²„íŠ¼ -->
                <div
                    class="search-toolbar left"
                    style="flex: 1"
                >
                    <div class="field">
                        <label>ê²€ìƒ‰ êµ¬ë¶„</label>
                        <select
                            ng-model="q.type"
                            ng-init="q.type = q.type || 'username'"
                            aria-label="ê²€ìƒ‰ êµ¬ë¶„"
                        >
                            <option value="username">ì‚¬ìš©ì</option>
                            <option value="email">ì´ë©”ì¼</option>
                            <option value="phone">ì „í™”</option>
                            <option value="role">ê¶Œí•œ</option>
                        </select>
                    </div>

                    <div class="field">
                        <input
                            type="search"
                            placeholder="ê²€ìƒ‰ì–´ ì…ë ¥"
                            ng-model="q.keyword"
                            ng-keydown="$event.keyCode === 13 && applySearch()"
                            aria-label="ê²€ìƒ‰ì–´ ì…ë ¥"
                            style="width: 100%"
                        />
                    </div>

                    <button
                        class="btn btn-ghost"
                        ng-click="resetSearch()"
                    >
                        ì´ˆê¸°í™”
                    </button>
                    <button
                        class="btn btn-primary"
                        ng-click="applySearch()"
                    >
                        ê²€ìƒ‰
                    </button>
                </div>

                <!-- ì˜¤ë¥¸ìª½: í˜ì´ì§€ í¬ê¸°/ì´ ê±´ìˆ˜ -->
                <div class="search-toolbar right">
                    <div class="field">
                        <label>í˜ì´ì§€ í¬ê¸°</label>
                        <select
                            ng-model="pageSize"
                            ng-options="s for s in pageSizes"
                            ng-change="onSize()"
                            aria-label="í˜ì´ì§€ í¬ê¸° ì„ íƒ"
                        ></select>
                    </div>
                    <div
                        class="field"
                        style="justify-content: flex-end"
                    >
                        <span class="muted">ì´ {{ (filtered && filtered.length) || 0 }}ê±´</span>
                    </div>
                </div>
            </div>
            <!-- /ê²€ìƒ‰ íˆ´ë°” -->

            <!-- í‘œ -->
            <table
                class="user-table"
                aria-label="ì‚¬ìš©ì ëª©ë¡"
            >
                <thead>
                    <tr>
                        <th style="width: 22%">ì‚¬ìš©ì</th>
                        <th style="width: 22%">ì´ë©”ì¼</th>
                        <th style="width: 16%">ì „í™”</th>
                        <th style="width: 16%">ê¶Œí•œ</th>
                        <th style="width: 24%">ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- âœ… ì—¬ê¸°: trë¥¼ ë‹«ì§€ ë§ê³  ì•ˆìª½ì— tdë¥¼ ë„£ì–´ì•¼ í•¨ -->
                    <tr ng-repeat="u in paged track by (u._uid || u.user_id || u.userId || u.id || $index)">
                        <td>
                            <span ng-if="!u._editing">{{ u.name }}</span>
                            <input
                                ng-if="u._editing"
                                class="inline-input"
                                type="text"
                                ng-model="u._editName"
                            />
                        </td>
                        <td>
                            <span ng-if="!u._editing">{{ u.email }}</span>
                            <input
                                ng-if="u._editing"
                                class="inline-input"
                                type="email"
                                ng-model="u._editEmail"
                            />
                        </td>
                        <td>
                            <span ng-if="!u._editing">{{ u.phone || '-' }}</span>
                            <input
                                ng-if="u._editing"
                                class="inline-input"
                                type="text"
                                ng-model="u._editPhone"
                            />
                        </td>
                        <td>
                            <span
                                class="pill"
                                ng-class="u._isAdmin ? 'green' : 'gray'"
                                >{{ u.roleLabel }}</span
                            >
                        </td>
                        <td>
                            <div ng-if="!u._editing">
                                <button
                                    class="btn btn-ghost"
                                    ng-click="startEdit(u)"
                                >
                                    ìˆ˜ì •
                                </button>
                                <button
                                    class="btn btn-danger"
                                    ng-click="deleteUser(u)"
                                >
                                    ì‚­ì œ
                                </button>
                            </div>
                            <div ng-if="u._editing">
                                <button
                                    class="btn btn-primary"
                                    ng-click="saveEdit(u)"
                                >
                                    ì €ì¥
                                </button>
                                <button
                                    class="btn btn-ghost"
                                    ng-click="cancelEdit(u)"
                                >
                                    ì·¨ì†Œ
                                </button>
                            </div>
                        </td>
                    </tr>

                    <tr ng-if="!paged.length">
                        <td
                            colspan="5"
                            style="text-align: center; color: #666"
                        >
                            í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div
                class="pager"
                style="margin-top: 10px"
            >
                <div class="left">
                    <span class="muted">í˜ì´ì§€ {{ (page || 0) + 1 }} / {{ pages || 1 }}</span>
                </div>
                <div class="right">
                    <button
                        class="btn-page"
                        ng-click="first()"
                        ng-disabled="page<=0"
                    >
                        Â« ì²˜ìŒ
                    </button>
                    <button
                        class="btn-page"
                        ng-click="prev()"
                        ng-disabled="page<=0"
                    >
                        â€¹ ì´ì „
                    </button>

                    <button
                        class="btn-page"
                        ng-repeat="p in pageRange()"
                        ng-class="{active:p===page}"
                        ng-click="go(p)"
                    >
                        {{ p + 1 }}
                    </button>

                    <button
                        class="btn-page"
                        ng-click="next()"
                        ng-disabled="page>=pages-1"
                    >
                        ë‹¤ìŒ â€º
                    </button>
                    <button
                        class="btn-page"
                        ng-click="last()"
                        ng-disabled="page>=pages-1"
                    >
                        ë Â»
                    </button>
                </div>
            </div>
            <!-- /í˜ì´ì§€ë„¤ì´ì…˜ -->
        </div>
    </div>
</div>
