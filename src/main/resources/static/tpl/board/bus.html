<!-- src/main/resources/static/tpl/board/bus.html -->
<div
    class="board-shell"
    ng-init="showComposer=false"
    ng-cloak
>
    <!-- í—¤ë”: ì œëª© + ìš°ì¸¡ ë²„íŠ¼ë“¤ -->
    <div class="section-header card-header-like">
        <div class="title-wrap">
            <span class="title-dot"></span>
            <h2 style="margin: 0">ëŒ€êµ¬ë²„ìŠ¤ ê²Œì‹œíŒ</h2>
        </div>
        <div class="header-actions">
            <button
                class="btn"
                ng-click="reload ? reload() : (loadPosts && loadPosts())"
                ng-disabled="loading"
                aria-label="ëª©ë¡ ìƒˆë¡œ ê³ ì¹¨"
            >
                ìƒˆë¡œ ê³ ì¹¨
            </button>
            <button
                class="btn primary"
                ng-click="showComposer = !showComposer"
                aria-expanded="{{!!showComposer}}"
            >
                {{ showComposer ? 'ì‘ì„± ë‹«ê¸°' : 'ê¸€ ì“°ê¸°' }}
            </button>
        </div>
    </div>

    <!-- ğŸ” ê²€ìƒ‰ ë°”: í•œ ì¤„ ì •ë ¬ -->
    <div class="search-bar card-header-like search-inline">
        <label class="label">ê²€ìƒ‰ êµ¬ë¶„</label>
        <select
            class="select"
            ng-model="q.type"
            aria-label="ê²€ìƒ‰ êµ¬ë¶„"
        >
            <option value="author">ì‘ì„±ì</option>
            <option value="content">ë‚´ìš©</option>
            <option value="author_content">ì‘ì„±ì+ë‚´ìš©</option>
            <option value="time">ê¸°ê°„</option>
        </select>

        <!-- í‚¤ì›Œë“œ ê²€ìƒ‰ -->
        <div
            ng-if="q.type !== 'time'"
            class="ctrl grow"
        >
            <input
                class="input-like w100"
                type="text"
                placeholder="ê²€ìƒ‰ì–´ ì…ë ¥"
                ng-model="q.keyword"
                aria-label="ê²€ìƒ‰ì–´"
            />
        </div>

        <!-- ê¸°ê°„ ê²€ìƒ‰ -->
        <div
            ng-if="q.type === 'time'"
            class="ctrl"
        >
            <label class="label sm">From</label>
            <input
                class="input-like"
                type="date"
                ng-model="q.from"
                aria-label="ì‹œì‘ì¼"
            />
            <label class="label sm">To</label>
            <input
                class="input-like"
                type="date"
                ng-model="q.to"
                aria-label="ì¢…ë£Œì¼"
            />
        </div>

        <div class="spacer"></div>

        <button
            class="btn"
            ng-click="resetSearch()"
            ng-disabled="loading"
        >
            ì´ˆê¸°í™”
        </button>
        <button
            class="btn primary"
            ng-click="applySearch()"
            ng-disabled="loading"
        >
            ê²€ìƒ‰
        </button>
    </div>

    <!-- ë¡œë”© í‘œì‹œ -->
    <div
        class="status-box"
        ng-if="loading"
        aria-live="polite"
    >
        â³ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>

    <!-- ê¸€ì“°ê¸°(í† ê¸€) -->
    <div
        class="composer-wrap"
        ng-show="showComposer"
    >
        <form
            ng-submit="createPost()"
            style="margin: 12px 0"
        >
            <input
                class="inline-input input-like"
                type="text"
                ng-model="newPost.title"
                placeholder="ì œëª©"
                aria-label="ì œëª©"
            />
            <br />
            <textarea
                class="inline-input input-like"
                style="height: 120px; margin-top: 8px"
                ng-model="newPost.content"
                placeholder="ë‚´ìš©"
                aria-label="ë‚´ìš©"
            ></textarea>
            <div style="margin-top: 8px; text-align: right">
                <button
                    class="btn primary"
                    type="submit"
                    ng-disabled="loading"
                >
                    ë“±ë¡
                </button>
            </div>
        </form>
    </div>

    <!-- â–½â–½â–½ í˜ì´ì§€ë„¤ì´ì…˜(ìƒë‹¨) â–½â–½â–½ -->
    <div class="pager">
        <div class="left">
            <label class="label">í˜ì´ì§€ í¬ê¸°</label>
            <select
                class="select"
                ng-model="pageSize"
                ng-options="s for s in pageSizes"
                ng-change="changeSize()"
                aria-label="í˜ì´ì§€ í¬ê¸° ì„ íƒ"
            ></select>
            <span
                class="muted"
                style="margin-left: 8px"
                >ì´ {{ total || 0 }}ê±´</span
            >
        </div>

        <div class="right">
            <button
                class="btn-page"
                ng-click="first()"
                ng-disabled="page <= 0 || loading"
                aria-label="ì²« í˜ì´ì§€"
            >
                Â« ì²˜ìŒ
            </button>
            <button
                class="btn-page"
                ng-click="prev()"
                ng-disabled="page <= 0 || loading"
                aria-label="ì´ì „ í˜ì´ì§€"
            >
                â€¹ ì´ì „
            </button>

            <button
                class="btn-page"
                ng-repeat="p in pageRange()"
                ng-class="{ active: p === page }"
                ng-click="go(p)"
                ng-disabled="loading"
                aria-label="{{ p + 1 }} í˜ì´ì§€"
            >
                {{ p + 1 }}
            </button>

            <button
                class="btn-page"
                ng-click="next()"
                ng-disabled="page >= pages - 1 || loading"
                aria-label="ë‹¤ìŒ í˜ì´ì§€"
            >
                ë‹¤ìŒ â€º
            </button>
            <button
                class="btn-page"
                ng-click="last()"
                ng-disabled="page >= pages - 1 || loading"
                aria-label="ë í˜ì´ì§€"
            >
                ë Â»
            </button>
        </div>
    </div>
    <!-- â–³â–³â–³ í˜ì´ì§€ë„¤ì´ì…˜(ìƒë‹¨) â–³â–³â–³ -->

    <!-- ëª©ë¡ ì¹´ë“œ -->
    <div class="board-card">
        <!-- í…Œì´ë¸” í—¤ë” -->
        <div class="table-head">
            <div class="c-title">ì œëª©</div>
            <div class="c-writer">ì‘ì„±ì</div>
            <div class="c-date">ì‘ì„±ì¼</div>
            <div class="c-actions">ì‘ì—…</div>
        </div>

        <!-- ê²Œì‹œê¸€ í–‰ -->
        <div
            class="table-row"
            ng-repeat="p in posts track by (p._uid || p.uuid || p.postId || p.id || $index)"
        >
            <!-- ì œëª©/ë‚´ìš©/ëŒ“ê¸€ -->
            <div class="c-title">
                <!-- ë³´ê¸° ëª¨ë“œ -->
                <div ng-if="!p._editing">
                    <div class="post-title"><strong>{{ p.title }}</strong></div>
                    <div
                        class="post-snippet"
                        ng-if="p.content"
                    >
                        {{ p.content }}
                    </div>
                    <button
                        class="btn light sm"
                        ng-click="toggleComments(p)"
                        ng-disabled="loading"
                    >
                        {{ p._showComments ? 'ëŒ“ê¸€ ë‹«ê¸°' : 'ëŒ“ê¸€ ë³´ê¸°' }}
                    </button>
                </div>

                <!-- ìˆ˜ì • ëª¨ë“œ -->
                <div ng-if="p._editing">
                    <input
                        class="inline-input input-like"
                        type="text"
                        ng-model="p._editTitle"
                        aria-label="ì œëª© ìˆ˜ì •"
                    />
                    <textarea
                        class="inline-input input-like"
                        style="height: 100px; margin-top: 6px"
                        ng-model="p._editContent"
                        aria-label="ë‚´ìš© ìˆ˜ì •"
                    ></textarea>
                    <div style="margin-top: 6px">
                        <button
                            class="btn primary"
                            ng-click="savePost(p)"
                            ng-disabled="loading"
                        >
                            ì €ì¥
                        </button>
                        <button
                            class="btn light"
                            ng-click="cancelEditPost(p)"
                        >
                            ì·¨ì†Œ
                        </button>
                    </div>
                </div>

                <!-- ëŒ“ê¸€ ì˜ì—­ -->
                <div
                    ng-if="p._showComments"
                    style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee"
                >
                    <div ng-if="!p._commentsLoaded">ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

                    <!-- ëŒ“ê¸€ ëª©ë¡ -->
                    <div
                        ng-repeat="c in p.comments track by (c._uid || c.uuid || c.commentId || c.id || $index)"
                        ng-style="{ 'padding-left': ((c.depth || 0) * 16) + 'px' }"
                        style="margin: 6px 0"
                    >
                        <!-- ëŒ“ê¸€ ë³´ê¸° -->
                        <div ng-if="!c._editing">
                            <strong>{{ c.writerName || c.writerId }}</strong> :
                            <span>{{ c.content }}</span>
                            <small style="color: #777"> Â· {{ c.createdAt | date:'MM-dd HH:mm' }}</small>

                            <button
                                class="btn btn-warning"
                                style="margin-left: 6px"
                                ng-if="me && (me.isAdmin || me.username === c.writerId)"
                                ng-click="startEditComment(c)"
                            >
                                ìˆ˜ì •
                            </button>
                            <button
                                class="btn btn-danger"
                                style="margin-left: 4px"
                                ng-if="me && (me.isAdmin || me.username === c.writerId)"
                                ng-click="deleteComment(p, c)"
                            >
                                ì‚­ì œ
                            </button>
                            <button
                                class="btn light"
                                style="margin-left: 4px"
                                ng-if="!c._replying"
                                ng-click="startReply(c)"
                            >
                                ë‹µê¸€
                            </button>
                        </div>

                        <!-- ëŒ“ê¸€ ìˆ˜ì • -->
                        <div ng-if="c._editing">
                            <textarea
                                class="inline-input input-like"
                                style="height: 80px"
                                ng-model="c._editContent"
                            ></textarea>
                            <div style="margin-top: 6px">
                                <button
                                    class="btn primary"
                                    ng-click="saveComment(p, c)"
                                    ng-disabled="loading"
                                >
                                    ì €ì¥
                                </button>
                                <button
                                    class="btn light"
                                    ng-click="cancelEditComment(c)"
                                >
                                    ì·¨ì†Œ
                                </button>
                            </div>
                        </div>

                        <!-- ëŒ€ëŒ“ê¸€ ì…ë ¥ -->
                        <div
                            ng-if="c._replying"
                            style="margin-top: 6px"
                        >
                            <input
                                class="inline-input input-like"
                                type="text"
                                ng-model="c._replyText"
                                placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"
                            />
                            <button
                                class="btn primary"
                                style="margin-left: 6px"
                                ng-click="submitReply(p, c)"
                                ng-disabled="loading"
                            >
                                ë“±ë¡
                            </button>
                            <button
                                class="btn light"
                                style="margin-left: 4px"
                                ng-click="cancelReply(c)"
                            >
                                ì·¨ì†Œ
                            </button>
                        </div>
                    </div>

                    <!-- ìƒˆ ëŒ“ê¸€ ì…ë ¥ -->
                    <div style="margin-top: 6px">
                        <input
                            class="inline-input input-like"
                            type="text"
                            ng-model="p._newComment"
                            placeholder="ëŒ“ê¸€ ì…ë ¥..."
                        />
                        <button
                            class="btn primary"
                            style="margin-left: 6px"
                            ng-click="addComment(p)"
                            ng-disabled="loading"
                        >
                            ë“±ë¡
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì‘ì„±ì -->
            <div class="c-writer">
                <span class="badge">{{ p.writerName || p.writerId || 'ìµëª…' }}</span>
                <span
                    class="muted"
                    ng-if="p.writerName && p.writerId"
                    >({{ p.writerId }})</span
                >
            </div>

            <!-- ì‘ì„±ì¼ -->
            <div class="c-date">{{ (p.createdAt || p.created_at) | date:'yyyy-MM-dd HH:mm' }}</div>

            <!-- ì‘ì—… -->
            <div class="c-actions">
                <button
                    class="btn btn-warning"
                    ng-if="me && (me.isAdmin || me.username === p.writerId)"
                    ng-click="startEditPost(p)"
                >
                    ìˆ˜ì •
                </button>
                <button
                    class="btn btn-danger"
                    ng-if="me && (me.isAdmin || me.username === p.writerId)"
                    ng-click="deletePost(p)"
                >
                    ì‚­ì œ
                </button>
            </div>
        </div>

        <!-- ë¹„ì–´ ìˆì„ ë•Œ -->
        <div
            class="table-empty"
            ng-if="!loading && (!posts || posts.length === 0)"
        >
            ë“±ë¡ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
    </div>

    <!-- â–½â–½â–½ í˜ì´ì§€ë„¤ì´ì…˜(í•˜ë‹¨) â–½â–½â–½ -->
    <div
        class="pager"
        style="margin-top: 10px"
    >
        <div class="left">
            <span class="muted">í˜ì´ì§€ {{ (page || 0) + 1 }} / {{ pages || 1 }}</span>
        </div>

        <div class="right">
            <button
                class="btn-page"
                ng-click="first()"
                ng-disabled="page <= 0 || loading"
            >
                Â« ì²˜ìŒ
            </button>
            <button
                class="btn-page"
                ng-click="prev()"
                ng-disabled="page <= 0 || loading"
            >
                â€¹ ì´ì „
            </button>

            <button
                class="btn-page"
                ng-repeat="p in pageRange()"
                ng-class="{ active: p === page }"
                ng-click="go(p)"
                ng-disabled="loading"
            >
                {{ p + 1 }}
            </button>

            <button
                class="btn-page"
                ng-click="next()"
                ng-disabled="page >= pages - 1 || loading"
            >
                ë‹¤ìŒ â€º
            </button>
            <button
                class="btn-page"
                ng-click="last()"
                ng-disabled="page >= pages - 1 || loading"
            >
                ë Â»
            </button>
        </div>
    </div>
    <!-- â–³â–³â–³ í˜ì´ì§€ë„¤ì´ì…˜(í•˜ë‹¨) â–³â–³â–³ -->
</div>

<!-- ===== ìŠ¤íƒ€ì¼(í˜ì´ì§€ ë‚´ë¶€ ì „ìš©) ===== -->
<style>
    [ng-cloak] {
        display: none;
    }
    .board-shell {
        padding: 12px;
    }

    /* ìƒë‹¨ í—¤ë” / ê²€ìƒ‰ ë°” ê³µìš© ì¹´ë“œ */
    .card-header-like {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #fff;
        border: 1px solid #edf0f5;
        border-radius: 12px;
        padding: 12px 16px;
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.04);
        margin-bottom: 12px;
    }
    .title-wrap {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .title-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #2d7ef7;
    }

    /* ğŸ” ê²€ìƒ‰ ë°”: í•œ ì¤„ ì •ë ¬ */
    .search-inline {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: nowrap;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .search-inline .ctrl {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .search-inline .grow {
        flex: 1 1 360px;
    }
    .search-inline .w100 {
        width: 100%;
    }
    .search-inline .spacer {
        flex: 1 1 auto;
        min-width: 12px;
    }

    /* ì¢ì€ í™”ë©´ì—ì„œëŠ” ìë™ ì¤„ë°”ê¿ˆ */
    @media (max-width: 820px) {
        .search-inline {
            flex-wrap: wrap;
        }
        .search-inline .spacer {
            display: none;
        }
        .search-inline .grow {
            flex: 1 1 100%;
        }
    }

    /* ë²„íŠ¼ */
    .btn {
        border: 1px solid #d7ddea;
        background: #fff;
        padding: 7px 12px;
        border-radius: 10px;
        font-size: 14px;
        cursor: pointer;
    }
    .btn:hover {
        background: #f7f9fc;
    }
    .btn.primary {
        background: #2d7ef7;
        color: #fff;
        border-color: #2d7ef7;
    }
    .btn.light {
        background: #f6f8fb;
        border-color: #e3e8f2;
    }
    .btn.sm {
        padding: 4px 8px;
        font-size: 12px;
    }
    .btn-page {
        border: 1px solid #d7ddea;
        background: #fff;
        padding: 6px 10px;
        border-radius: 8px;
        cursor: pointer;
    }
    .btn-page.active {
        background: #2d7ef7;
        color: #fff;
        border-color: #2d7ef7;
    }
    .btn-danger {
        background: #e74c3c;
        color: #fff;
        border-color: #e74c3c;
    }
    .btn-warning {
        background: #f39c12;
        color: #fff;
        border-color: #f39c12;
    }

    /* ì¸í’‹ */
    .input-like {
        width: 100%;
        box-sizing: border-box;
        border: 1px solid #d7ddea;
        border-radius: 10px;
        padding: 10px 12px;
        outline: none;
        font-size: 14px;
        min-width: 160px;
    }
    .input-like:focus {
        border-color: #2d7ef7;
    }

    /* ë¼ë²¨/ì…€ë ‰íŠ¸ */
    .label {
        margin-right: 6px;
        color: #5a6a85;
    }
    .label.sm {
        margin: 0 6px 0 0;
        font-size: 12px;
        color: #6b7280;
    }
    .select {
        border: 1px solid #d7ddea;
        border-radius: 8px;
        padding: 6px 8px;
        outline: none;
        background: #fff;
    }

    /* ì‘ì„± í¼ */
    .composer-wrap {
        background: #fff;
        border: 1px solid #edf0f5;
        border-radius: 12px;
        padding: 12px 16px;
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.04);
        margin-bottom: 12px;
    }

    /* ì¹´ë“œ(ëª©ë¡) */
    .board-card {
        background: #fff;
        border: 1px solid #edf0f5;
        border-radius: 12px;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.06);
        overflow: hidden;
    }

    /* í…Œì´ë¸” ë ˆì´ì•„ì›ƒ */
    .table-head,
    .table-row {
        display: grid;
        grid-template-columns: 1fr 180px 180px 220px;
        gap: 12px;
        align-items: center;
        padding: 14px 16px;
    }
    .table-head {
        color: #5a6a85;
        font-weight: 600;
        font-size: 13px;
        background: #f8fafc;
        border-bottom: 1px solid #eef2f7;
    }
    .table-row {
        border-bottom: 1px solid #f0f3f8;
    }
    .table-row:hover {
        background: #fbfdff;
    }
    .table-empty {
        padding: 24px 16px;
        color: #8a94a6;
    }

    /* ì…€ ë‚´ìš© */
    .post-title {
        font-weight: 600;
        margin-bottom: 6px;
    }
    .post-snippet {
        color: #6b7280;
        font-size: 13px;
        margin-bottom: 8px;
    }
    .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 999px;
        font-size: 12px;
        background: #eef4ff;
        color: #3556e0;
        border: 1px solid #dce6ff;
    }

    /* í˜ì´ì§€ë„¤ì´ì…˜ ë°” */
    .pager {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #fff;
        border: 1px solid #edf0f5;
        border-radius: 12px;
        padding: 10px 12px;
        margin: 12px 0;
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.04);
    }
    .pager .muted {
        color: #6b7280;
    }
</style>
