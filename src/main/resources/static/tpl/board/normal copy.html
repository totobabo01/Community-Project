<!-- src/main/resources/static/tpl/board/normal.html -->
<div class="section-header">
    <h2 style="margin: 0">일반 게시판</h2>
</div>

<!-- 로딩 표시 -->
<div
    class="status-box"
    ng-if="loading"
>
    ⏳ 불러오는 중...
</div>

<!-- 새 글 작성 -->
<form
    ng-submit="createPost()"
    style="margin: 12px 0"
>
    <input
        class="inline-input"
        type="text"
        ng-model="newPost.title"
        placeholder="제목"
    />
    <br />
    <textarea
        class="inline-input"
        style="height: 120px; margin-top: 8px"
        ng-model="newPost.content"
        placeholder="내용"
    ></textarea>
    <div style="margin-top: 8px">
        <button
            class="btn btn-primary"
            type="submit"
        >
            등록
        </button>
    </div>
</form>

<!-- ▽▽▽ 페이지네이션(상단) ▽▽▽ -->
<div class="pager">
    <div class="left">
        <label class="label">페이지 크기</label>
        <select
            class="select"
            ng-model="pageSize"
            ng-options="s for s in pageSizes"
            ng-change="changeSize()"
        ></select>
        <span
            class="muted"
            style="margin-left: 8px"
            >총 {{ total || 0 }}건</span
        >
    </div>

    <div class="right">
        <button
            class="btn-page"
            ng-click="first()"
            ng-disabled="page <= 0"
        >
            « 처음
        </button>
        <button
            class="btn-page"
            ng-click="prev()"
            ng-disabled="page <= 0"
        >
            ‹ 이전
        </button>

        <button
            class="btn-page"
            ng-repeat="p in pageRange()"
            ng-class="{ active: p === page }"
            ng-click="go(p)"
        >
            {{ p + 1 }}
        </button>

        <button
            class="btn-page"
            ng-click="next()"
            ng-disabled="page >= pages - 1"
        >
            다음 ›
        </button>
        <button
            class="btn-page"
            ng-click="last()"
            ng-disabled="page >= pages - 1"
        >
            끝 »
        </button>
    </div>
</div>
<!-- △△△ 페이지네이션(상단) △△△ -->

<ul
    class="user-table"
    style="padding: 0; border: 1px solid #edf0f5; border-radius: 12px"
>
    <li
        style="list-style: none; padding: 12px; border-bottom: 1px solid #eee"
        ng-repeat="p in posts track by (p._uid || p.uuid || p.postId || p.id || $index)"
    >
        <!-- 게시글 보기 모드 -->
        <div ng-if="!p._editing">
            <strong>{{ p.title }}</strong>
            <div style="color: #666; margin: 4px 0">{{ p.content }}</div>

            <small>
                {{ p.writerName || p.writerId || '익명' }}
                <span ng-if="p.writerName && p.writerId"> ({{ p.writerId }})</span>
                · {{ p.createdAt | date:'yyyy-MM-dd HH:mm' }}
            </small>

            <div style="margin-top: 6px">
                <button
                    class="btn btn-warning"
                    ng-if="me && (me.isAdmin || me.username === p.writerId)"
                    ng-click="startEditPost(p)"
                >
                    수정
                </button>

                <button
                    class="btn btn-danger"
                    ng-if="me && (me.isAdmin || me.username === p.writerId)"
                    ng-click="deletePost(p)"
                >
                    삭제
                </button>

                <button
                    class="btn btn-neutral"
                    ng-click="toggleComments(p)"
                >
                    {{ p._showComments ? '댓글 닫기' : '댓글 보기' }}
                </button>
            </div>
        </div>

        <!-- 게시글 수정 모드 -->
        <div ng-if="p._editing">
            <input
                class="inline-input"
                type="text"
                ng-model="p._editTitle"
            />
            <textarea
                class="inline-input"
                style="height: 100px; margin-top: 6px"
                ng-model="p._editContent"
            ></textarea>
            <div style="margin-top: 6px">
                <button
                    class="btn btn-primary"
                    ng-click="savePost(p)"
                >
                    저장
                </button>
                <button
                    class="btn btn-neutral"
                    ng-click="cancelEditPost(p)"
                >
                    취소
                </button>
            </div>
        </div>

        <!-- 댓글 영역 -->
        <div
            ng-if="p._showComments"
            style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee"
        >
            <div ng-if="!p._commentsLoaded">댓글 불러오는 중...</div>

            <!-- 댓글 목록 -->
            <div
                ng-repeat="c in p.comments track by (c._uid || c.uuid || c.commentId || c.id || $index)"
                ng-style="{ 'padding-left': ((c.depth || 0) * 16) + 'px' }"
                style="margin: 6px 0"
            >
                <!-- 댓글 보기 모드 -->
                <div ng-if="!c._editing">
                    <strong>{{ c.writerName || c.writerId }}</strong> :
                    <span>{{ c.content }}</span>
                    <small style="color: #777"> · {{ c.createdAt | date:'MM-dd HH:mm' }}</small>

                    <button
                        class="btn btn-warning"
                        style="margin-left: 6px"
                        ng-if="me && (me.isAdmin || me.username === c.writerId)"
                        ng-click="startEditComment(c)"
                    >
                        수정
                    </button>

                    <button
                        class="btn btn-danger"
                        style="margin-left: 4px"
                        ng-if="me && (me.isAdmin || me.username === c.writerId)"
                        ng-click="deleteComment(p, c)"
                    >
                        삭제
                    </button>

                    <button
                        class="btn btn-neutral"
                        style="margin-left: 4px"
                        ng-if="!c._replying"
                        ng-click="startReply(c)"
                    >
                        답글
                    </button>
                </div>

                <!-- 댓글 수정 모드 -->
                <div ng-if="c._editing">
                    <textarea
                        class="inline-input"
                        style="height: 80px"
                        ng-model="c._editContent"
                    ></textarea>
                    <div style="margin-top: 6px">
                        <button
                            class="btn btn-primary"
                            ng-click="saveComment(p, c)"
                        >
                            저장
                        </button>
                        <button
                            class="btn btn-neutral"
                            ng-click="cancelEditComment(c)"
                        >
                            취소
                        </button>
                    </div>
                </div>

                <!-- 대댓글 입력 영역 -->
                <div
                    ng-if="c._replying"
                    style="margin-top: 6px"
                >
                    <input
                        class="inline-input"
                        type="text"
                        ng-model="c._replyText"
                        placeholder="답글을 입력하세요"
                    />
                    <button
                        class="btn btn-primary"
                        style="margin-left: 6px"
                        ng-click="submitReply(p, c)"
                    >
                        등록
                    </button>
                    <button
                        class="btn btn-neutral"
                        style="margin-left: 4px"
                        ng-click="cancelReply(c)"
                    >
                        취소
                    </button>
                </div>
            </div>

            <!-- 새 댓글 입력 -->
            <div style="margin-top: 6px">
                <input
                    class="inline-input"
                    type="text"
                    ng-model="p._newComment"
                    placeholder="댓글 입력..."
                />
                <button
                    class="btn btn-primary"
                    style="margin-left: 6px"
                    ng-click="addComment(p)"
                >
                    등록
                </button>
            </div>
        </div>
    </li>
</ul>

<!-- ▽▽▽ 페이지네이션(하단) ▽▽▽ -->
<div
    class="pager"
    style="margin-top: 10px"
>
    <div class="left">
        <span class="muted">페이지 {{ (page || 0) + 1 }} / {{ pages || 1 }}</span>
    </div>

    <div class="right">
        <button
            class="btn-page"
            ng-click="first()"
            ng-disabled="page <= 0"
        >
            « 처음
        </button>
        <button
            class="btn-page"
            ng-click="prev()"
            ng-disabled="page <= 0"
        >
            ‹ 이전
        </button>

        <button
            class="btn-page"
            ng-repeat="p in pageRange()"
            ng-class="{ active: p === page }"
            ng-click="go(p)"
        >
            {{ p + 1 }}
        </button>

        <button
            class="btn-page"
            ng-click="next()"
            ng-disabled="page >= pages - 1"
        >
            다음 ›
        </button>
        <button
            class="btn-page"
            ng-click="last()"
            ng-disabled="page >= pages - 1"
        >
            끝 »
        </button>
    </div>
</div>
<!-- △△△ 페이지네이션(하단) △△△ -->
